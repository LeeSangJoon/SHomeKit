## Plug 내장 자동 스위칭 기능 작동 오류

* 내장 자동 스위칭 기능이란?
  * Plug의 내장 웹페이지에 설정 할 수 있는 기능으로
설정 해놓은 시간동안 플러그의 릴레이를 자동으로 차단하는 기능
![image1](https://raw.githubusercontent.com/sonnonet/SHomeKit/master/img/autoswitching1.png)
![image2](https://raw.githubusercontent.com/sonnonet/SHomeKit/master/img/autoswitching2.png)
- 해당 기능에 대한 Issue
  * 테스트를 위해 2016년 8월 1일경 외부에 설치를 해놨으나 2016년 8월 20일경부터 동작이 안됨을 확인함.<br>
(2016년 9월 9일 11시 30분경 작동이 안되고 있음을 발견)
  *  2016년 8월 20일경부터 안됐다고 확정지을 수 있는 이유:
    * 위의 사진을 보면 알겠지만 메인화면에서 자동스위칭 되는 시작시간과 끝시간을 표시해줌.<br>
    그런데 확인차 내장 웹페이지를 접속했더니 해당 날짜에서 멈춰져 있었고, 시작시간과 끝시간이 1일씩 증가하더니 
    확인 날짜였던 2016년 9월 9일 날짜에서 멈추고 자동스위칭이 정상적으로 동작함.
  * 시작과 끝시간이 1일씩 증가하는 이유:
    * 자동스위칭이 동작할 시, 그리고 자동스위칭 설정을 바꿀 시 내부 메모리에 마지막으로 동작했던 시간값을 저장함.<br>
만약 자동스위칭을 잘 작동시키다가 문제가 생김으로 인하여 플러그의 전원이 리셋되었을 때 현재날짜와 자동스위칭 시작과 끝 날짜를 동기화하게
되어있음.
    * 알고리즘 적으로 1일씩 증가하지 않고 해당날짜에서 멈추게 할 수는 있으나 
테스트 단계임을 고려해 간단하고 확실히 동작하는 방법으로 짜놓은 상태.
 
- 개발자가 생각하는 해당 문제에 대한 발생 이유 (예상이며 가정임):

1.  외부에 설치했던 장소의 문제로 플러그의 전원이 리셋됨 <br>
(멀티탭 전원 내림 혹은 플러그를 뽑음 혹은 정전됨 혹은 점검차 차단기를 내림)<br>
외부에 설치했을 때 SoftAP상태에서 설정했기때문에 플러그의 전원이 나갔었을 경우 자동으로 시간을 받아오지 못함.
(Infrastructure 모드일경우 자동으로 외부서버에서 현재시간 받아오는것이 가능)
  * 만약 위와 같은 경우 해결할 방법이 불투명한 이유:
    * 자동스위칭 기능은 '특정된 실시간 시간동안 전기 사용을 하지않겠다.' 라는 기능이기때문에
반드시 Realtime이 필요함. <br> 
    하지만 플러그의 전원이 사라질경우 전원이 사라진 순간부터 전원이 다시 공급된 시간까지 걸린 시간을 
알 방법이 없기 때문에 이를 해결하기에는 어려움이 많음. <br>
(참고로 SoftAP 상태에서는 내부 웹페이지의 Javascript로 접속했던 모바일기기의 현재시간을 얻어옴)
2. 내부 클럭 오류로 인한 오류 (가능성 낮음):
  * Realtime을 받아 온 후 내부 클럭으로 1초마다 Realtime 변수를 증가시키기 때문에 타이머 오류가 났다면 충분히 동작이 안될 수 있음. <br>
하지만 위에에도 언급했듯, 모바일로 웹페이지에 접속했더니 자동스위칭 기능의 시작과 끝시간이 자동으로 하루씩 증가함. <br>
자동으로 하루씩 증가하는 알고리즘은 '같은 타이머 내'에 위치하고 있음.
고로 타이머는 잘 동작하고 있다는 증거임.
내부 클럭 오류로 인해 Realtime변수가 밀려나거나 땡겨져서 엉뚱한 시간대에 자동 스위칭이 
동작했고 모바일로 다시 Realtime을 받아서 정상적으로 작동했다면 말이 다르지만 해당 가정은 가능성이 낮다고 판단.
3. 알고리즘 자체의 문제
  * 아직 테스팅 단계고 짧은 시간의 테스트에는 문제가 발생을 안했지만, 장시간 이용했을 시 알고리즘 적으로 문제가 발생하는 거라면
지금 당장 알 수 가 없음. <br>
  이유는 분명 몇일간은 작동하고 알고리즘 상으로도 이상한 점을 발견 하지 못했기때문에
당장 해볼수 있는 방법은 장시간의 테스트를 통해서 '1번 2번의 가정이 확실히 아니다.' 라는 결론이 필요함.
